{% load static %}
{% load lottery_extras %}

{% comment %}Form order create{% endcomment %}

{% if pending_order %}
  <div class="pending-order">
    <p>Tu pago ha sido enviado y está siendo verificado.</p>
  </div>
{% else %}
  <hr />
  <h3>Comprar tickets</h3>
  <div class="payment-methods">
    <label for="id_payment_method">Método de pago</label>
    <select name="" id="id_payment_method" hx-on:change="changePaymentMethod()">
      <option value="0" {% if payment_method == "0" %}selected{% endif %}>Pago móvil</option>
      <option value="1" {% if payment_method == "1" %}selected{% endif %}>Zelle</option>
      <option value="2" {% if payment_method == "2" %}selected{% endif %}>Paypal</option>
    </select>
  </div>
  <div class="order-create" id="id_order_create">
    <form class="form-order-create" hx-post="{% url 'order-create' %}?payment_method={{ payment_method }}&lottery={{ lottery.pk }}" hx-on::after-process-node="amount({{ payment_method }})" method="post" hx-target="#id_div_order_create">
      {% csrf_token %}
      <input type="hidden" name="lottery" value="{{ lottery.pk }}" />
      <input type="hidden" name="user" value="{{ user.pk }}" />
      <input type="hidden" name="dollar" value="1" />
      <input type="hidden" name="payment_method" value="{{ payment_method }}" />
      {% comment %}Pago móvil{% endcomment %}
      {% if payment_method == '0' %}
        <div class="form-info">
          <h5>Datos Pago Móvil</h5>
          <div class="info-field">
            <p>Cédula</p>
            <p>V-12.345.678</p>
          </div>
          <div class="info-field">
            <p>Télefono</p>
            <p>0412-345-6789</p>
          </div>
          <div class="info-field">
            <p>Banco</p>
            <p>Banco de Venezuela (0102)</p>
          </div>
        </div>

        <div class="form-field form-quantity">
          <label for="id_quantity">Cantidad</label>
          <select name="quantity" id="id_quantity" hx-on:change="amount({{ payment_method }}, this.value)">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
        </div>

        <div class="form-input">
          {{ form.reference }}
          {% if form.reference.errors %}
            <div class="error">
              <p>Ingrese un número de referencia válido (mínimo 6 caracteres).</p>
            </div>
          {% endif %}
        </div>
        <div class="form-input split-dni">{{ form.type_of_dni }}
          {{ form.dni }}
          {% if form.dni.errors %}
            <div class="error">
              <p>Ingrese un número de cédula válido.</p>
            </div>
          {% endif %}
        </div>
        <div class="form-input">
          {{ form.phone }}
          {% for error in form.phone.errors %}
            <div class="error">
              <p>{{ error }}</p>
            </div>
          {% endfor %}
        </div>
        <div class="form-input">{{ form.bank_code }}</div>
        <div class="form-input">{{ form.amount_bs }}</div>

        {% comment %}Zelle{% endcomment %}
      {% elif payment_method == '1' %}
        <div class="form-info">
          <div class="info-field">
            <p>Email</p>
            <p>email@email.com</p>
          </div>
        </div>
        <div class="form-field form-quantity">
          <label for="id_quantity">Cantidad</label>
          <select name="quantity" id="id_quantity" hx-on:change="amount({{ payment_method }}, this.value)">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
        </div>
        <div class="form-input">{{ form.email_or_phone }}</div>
        <div class="form-input">{{ form.amount_usd }}</div>
        {% comment %}Paypal{% endcomment %}
      {% elif payment_method == '2' %}
        <div class="form-info">
          <div class="info-field">
            <p>Email</p>
            <p>email@email.com</p>
          </div>
        </div>
        <div class="form-field form-quantity">
          <label for="id_quantity">Cantidad</label>
          <select name="quantity" id="id_quantity" hx-on:change="amount({{ payment_method }}, this.value)">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
        </div>
        <div class="form-input">{{ form.email_or_phone }}</div>
        <div class="form-input">{{ form.amount_usd }}</div>
      {% endif %}
      <p class="info-pay">
        Una vez realizado el pago pulse <b>Enviar</b>
      </p>
      <input type="submit" value="Enviar" class="button-pay" />
    </form>
  </div>
{% endif %}

{% comment %}
<form id="id_form_order_create" class="form" action="{% url 'order-create' %}" method="post">
  {% csrf_token %}
  <input type="hidden" name="dollar" value="{{ dollar }}" />

  <input type="hidden" name="user" value="{{ user.pk }}" />

  <input type="hidden" name="lottery" value="{{ lottery.pk }}" />

  <h3>Comprar tickets</h3>
  <div class="form-fields">
    <select id="id_quantity" class="form-field form-field-select" name="quantity" hx-on:change="set_amount(this.value)">
      <button><selectedcontent></selectedcontent></button>
      {% for num in select_number %}
        <option class="option" value="{{ num }}">{{ num }}</option>
      {% endfor %}
    </select>
    <input id="id_reference" class="form-field" name="reference" type="number" placeholder="Nro. de referencia" required />
    <button class="button" onclick="event.preventDefault();show_confirm(htmx.find('#id_quantity').value);">Comprar</button>
  </div>

  <h3>Método de pago</h3>
  <div class="payment-methods">
    <div class="payment-method">
      <p>Pago móvil</p>
    </div>
    <div class="payment-method">
      <p>Zelle</p>
    </div>
    <div class="payment-method">
      <p>Paypal</p>
    </div>
  </div>
</form>

{% endcomment %}
