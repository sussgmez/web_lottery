{% load static %}
{% load lottery_extras %}

{% comment %}Form order create{% endcomment %}

{% if pending_order %}
  <div class="pending-order">
    <p>Tu pago ha sido enviado y está siendo verificado.</p>
  </div>
{% else %}
  <hr />
  <h3>Comprar tickets</h3>
  <p>Métodos de pagos</p>
  <div class="payment-methods">
    <div class="payment-method" hx-on:click="changePaymentMethod(0)">
      <img src="{% static 'img/bdv.png' %}" alt="BDV" />
      <p>Pago móvil</p>
    </div>
    <div class="payment-method" hx-on:click="changePaymentMethod(1)">
      <img src="{% static 'img/zelle.png' %}" alt="BDV" />
      <p>Zelle</p>
    </div>
    <div class="payment-method" hx-on:click="changePaymentMethod(2)">
      <img src="{% static 'img/paypal.png' %}" alt="BDV" />
      <p>Paypal</p>
    </div>
  </div>
  <div class="order-create" id="id_order_create">
    <form class="form-order-create" hx-post="{% url 'order-create' %}?payment_method={{ payment_method }}&lottery={{ lottery.pk }}" hx-on::after-process-node="amount({{ payment_method }})" method="post" hx-target="#id_div_order_create">
      {% csrf_token %}
      <input type="hidden" name="lottery" value="{{ lottery.pk }}" />
      <input type="hidden" name="user" value="{{ user.pk }}" />
      <input type="hidden" name="dollar" value="1" />
      <input type="hidden" name="payment_method" value="{{ payment_method }}" />
      {% comment %}Pago móvil{% endcomment %}
      {% if payment_method == '0' %}
        <div class="form-info">
          <h5>Datos Pago Móvil</h5>
          <div class="info-field">
            <p>Cédula</p>
            <p>V-12.345.678</p>
          </div>
          <div class="info-field">
            <p>Télefono</p>
            <p>0412-345-6789</p>
          </div>
          <div class="info-field">
            <p>Banco</p>
            <p>Banco de Venezuela (0102)</p>
          </div>
        </div>

        <div class="form-field form-quantity">
          <label for="id_quantity">Cantidad</label>
          <select name="quantity" id="id_quantity" hx-on:change="amount({{ payment_method }}, this.value)">
            {% for number in available_tickets %}
              <option value="{{ number }}">{{ number }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-input">
          {{ form.reference }}
          {% if form.reference.errors %}
            <div class="error">
              <p>Ingrese un número de referencia válido (mínimo 6 caracteres).</p>
            </div>
          {% endif %}
        </div>
        <div class="form-input split-dni">
          {{ form.type_of_dni }}
          {{ form.dni }}
          {% if form.dni.errors %}
            <div class="error">
              <p>Ingrese un número de cédula válido.</p>
            </div>
          {% endif %}
        </div>
        <div class="form-input">
          {{ form.phone }}
          {% for error in form.phone.errors %}
            <div class="error">
              <p>{{ error }}</p>
            </div>
          {% endfor %}
        </div>
        <div class="form-input">{{ form.bank_code }}</div>
        <div class="form-input">{{ form.amount_bs }}</div>

        {% comment %}Zelle{% endcomment %}
      {% elif payment_method == '1' %}
        <div class="form-info">
          <h5>Datos Zelle</h5>
          <div class="info-field">
            <p>Email</p>
            <p>email@email.com</p>
          </div>
        </div>
        <div class="form-field form-quantity">
          <label for="id_quantity">Cantidad</label>
          <select name="quantity" id="id_quantity" hx-on:change="amount({{ payment_method }}, this.value)">
            {% for number in available_tickets %}
              <option value="{{ number }}">{{ number }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-input">{{ form.email_or_phone }}</div>
        <div class="form-input">{{ form.amount_usd }}</div>
        {% comment %}Paypal{% endcomment %}
      {% elif payment_method == '2' %}
        <div class="form-info">
          <h5>Datos Paypal</h5>
          <div class="info-field">
            <p>Email</p>
            <p>email@email.com</p>
          </div>
        </div>
        <div class="form-field form-quantity">
          <label for="id_quantity">Cantidad</label>
          <select name="quantity" id="id_quantity" hx-on:change="amount({{ payment_method }}, this.value)">
            {% for number in available_tickets %}
              <option value="{{ number }}">{{ number }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="form-input">{{ form.email_or_phone }}</div>
        <div class="form-input">{{ form.amount_usd }}</div>
      {% endif %}
      <p class="info-pay">
        Una vez realizado el pago pulse <b>Enviar</b>
      </p>
      <input type="submit" value="Enviar" class="button-pay" />
    </form>
  </div>
{% endif %}
