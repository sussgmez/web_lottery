{% extends 'core/base.html' %}
{% load lottery_extras %}

{% block content %}
  <div>
    <section class="section-lottery">
      <div class="lottery-image">
        <img src="{{ lottery.image.url }}" alt="" />
      </div>
      <div class="lottery-info">
        <h2>{{ lottery.description }}</h2>
        <p class="lottery-data">
          <b>Cierre del sorteo:</b>{{ lottery.closing_date|date:'d/m/Y' }}
        </p>
        <p class="lottery-data">
          <b>Ticket:</b>{{ lottery.price|floatformat_dot }}$
        </p>
        <hr />
        {% if not orders %}
          <div class="id_order_create" hx-get="{% url 'order-create' %}?lottery={{ object.pk }}" hx-trigger="load"></div>
        {% else %}
          <p class="pending">Tienes una orden pendiente de revisi√≥n</p>
        {% endif %}
      </div>
    </section>
  </div>
{% endblock %}

{% block extra_js %}
  <script>
    function set_amount(quantity) {
      htmx.find('#id_amount_dollar').innerHTML = parseFloat(quantity * {{ lottery.price|floatformat_dot }}).toFixed(2)
      htmx.find('#id_amount_bs').innerHTML = parseFloat(quantity * {{ dollar.exchange_rate|floatformat_dot }} *{{ lottery.price|floatformat_dot }}).toFixed(2)
    }
    function show_confirm(quantity) {
      let isReferenceValidity = htmx.find('#id_reference').checkValidity()
      if (isReferenceValidity) {
        htmx.find('#id_confirm').style.display = 'flex'
      } else {
        htmx.find('#id_reference').reportValidity()
      }
    }
    function show_confirm(quantity) {
      let isReferenceValidity = htmx.find('#id_reference').checkValidity()
      if (isReferenceValidity) {
        htmx.find('#id_check_quantity').innerHTML = quantity
        htmx.find('#id_check_amount_bs').innerHTML = parseFloat(quantity * {{ dollar.exchange_rate|floatformat_dot }} *{{ lottery.price|floatformat_dot }}).toFixed(2)
        htmx.toggleClass('#id_confirm', 'hidden')
      } else {
        htmx.find('#id_reference').reportValidity()
      }
    }
    
  </script>
{% endblock %}
